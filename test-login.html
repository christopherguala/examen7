<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Login Flow</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 2px solid #00f032;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #00f032;
            color: black;
        }
        .error {
            background: #fe3301;
            color: white;
        }
        .info {
            background: #00d4ff;
            color: black;
        }
        button {
            background: #00f032;
            color: black;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #02c02b;
        }
        input {
            background: #1a1a1a;
            color: white;
            border: 2px solid #00f032;
            padding: 8px;
            border-radius: 4px;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>üîê Test del Flujo de Autenticaci√≥n</h1>
    
    <div class="test-section">
        <h2>1. Verificar Usuario Demo</h2>
        <button onclick="checkDemoUser()">Verificar Usuario Demo</button>
        <div id="demo-result"></div>
    </div>

    <div class="test-section">
        <h2>2. Test de Login</h2>
        <input type="email" id="email" placeholder="Email" value="demo@test.com">
        <input type="password" id="password" placeholder="Password" value="123456">
        <button onclick="testLogin()">Probar Login</button>
        <div id="login-result"></div>
    </div>

    <div class="test-section">
        <h2>3. Test de Logout</h2>
        <button onclick="testLogout()">Probar Logout</button>
        <div id="logout-result"></div>
    </div>

    <div class="test-section">
        <h2>4. Estado Actual</h2>
        <button onclick="checkState()">Verificar Estado</button>
        <div id="state-result"></div>
    </div>

    <script>
        // Simular las funciones del store
        function getFromStorage(key) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            } catch (error) {
                console.error('Error reading from localStorage:', error);
                return null;
            }
        }

        function saveToStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                console.log(`üíæ Guardado en localStorage: ${key}`, data);
            } catch (error) {
                console.error('Error saving to localStorage:', error);
            }
        }

        function getUsers() {
            return getFromStorage('cyberWatch_users') || [];
        }

        function saveUsers(users) {
            saveToStorage('cyberWatch_users', users);
        }

        function login(email, password) {
            console.log('üîê Intentando login con:', { email, password: '***' });
            const users = getUsers();
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                console.log('‚úÖ Usuario encontrado:', user);
                
                // Guardar en localStorage
                saveToStorage('cyberWatch_user', user);
                saveToStorage('cyberWatch_isLoggedIn', true);
                
                console.log('üéâ Login exitoso, estado actualizado');
                return { success: true, message: 'Login exitoso', user };
            }
            
            console.log('‚ùå Usuario no encontrado o credenciales incorrectas');
            return { success: false, message: 'Credenciales incorrectas' };
        }

        function logout() {
            console.log('üö™ Cerrando sesi√≥n...');
            
            // Limpiar localStorage
            localStorage.removeItem('cyberWatch_user');
            localStorage.removeItem('cyberWatch_isLoggedIn');
            
            console.log('‚úÖ Sesi√≥n cerrada, localStorage limpiado');
        }

        function checkDemoUser() {
            const result = document.getElementById('demo-result');
            
            // Crear usuario demo si no existe
            const demoUser = {
                id: 'demo-001',
                name: 'Usuario Demo',
                email: 'demo@test.com',
                password: '123456',
                phone: '+56 9 1234 5678',
                createdAt: new Date().toISOString(),
                avatar: 'https://ui-avatars.com/api/?name=Usuario+Demo&background=00f032&color=000000&size=100'
            };
            
            const users = getUsers();
            const existingDemo = users.find(u => u.email === demoUser.email);
            
            if (!existingDemo) {
                users.push(demoUser);
                saveUsers(users);
                result.innerHTML = '<div class="test-result success">‚úÖ Usuario demo creado exitosamente</div>';
                console.log('üë§ Usuario demo creado:', demoUser);
            } else {
                result.innerHTML = '<div class="test-result info">‚ÑπÔ∏è Usuario demo ya existe</div>';
                console.log('üë§ Usuario demo ya existe');
            }
        }

        function testLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const result = document.getElementById('login-result');
            
            if (!email || !password) {
                result.innerHTML = '<div class="test-result error">‚ùå Email y password son requeridos</div>';
                return;
            }
            
            const loginResult = login(email, password);
            
            if (loginResult.success) {
                result.innerHTML = `<div class="test-result success">‚úÖ ${loginResult.message}</div>`;
            } else {
                result.innerHTML = `<div class="test-result error">‚ùå ${loginResult.message}</div>`;
            }
        }

        function testLogout() {
            const result = document.getElementById('logout-result');
            logout();
            result.innerHTML = '<div class="test-result success">‚úÖ Logout exitoso</div>';
        }

        function checkState() {
            const result = document.getElementById('state-result');
            const savedUser = getFromStorage('cyberWatch_user');
            const savedLoginState = getFromStorage('cyberWatch_isLoggedIn');
            const users = getUsers();
            
            let html = `
                <div class="test-result info">
                    <strong>Estado Actual:</strong><br>
                    üìß Usuario guardado: ${savedUser ? savedUser.name + ' (' + savedUser.email + ')' : 'Ninguno'}<br>
                    üîê Estado de login: ${savedLoginState ? 'Logueado' : 'No logueado'}<br>
                    üë• Usuarios registrados: ${users.length}
                </div>
            `;
            
            if (users.length > 0) {
                html += '<div class="test-result info"><strong>Usuarios en el sistema:</strong><br>';
                users.forEach(user => {
                    html += `- ${user.name} (${user.email})<br>`;
                });
                html += '</div>';
            }
            
            result.innerHTML = html;
        }

        // Verificar estado inicial
        window.onload = function() {
            checkDemoUser();
            checkState();
        };
    </script>
</body>
</html>
